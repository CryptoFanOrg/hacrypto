<html>
<head>
<!--
     Copyright (c) 1998-2014 The OpenSSL Project, http://www.openssl.org/
     Author:   OpenSSL (openssl@openssl.org)
     Modified: 2013-01-17 09:33:31.
     Generated from ``bn_internal.wml'' via WML 2.0.11 (19-Aug-2006).
               by OpenSSL (openssl@openssl.org)
               on 2014-05-01 12:15:00.

     DO NOT EDIT THIS FILE DIRECTLY! INSTEAD EDIT ``bn_internal.wml''.
-->
<meta name="Copyright" content="1998-2014 The OpenSSL Project, http://www.openssl.org/">
<meta name="Author"    content="OpenSSL, openssl@openssl.org">
<meta name="Generator" content="WML 2.0.11 (19-Aug-2006)">
<meta name="Modified"  content="2013-01-17 09:33:31">
<title>OpenSSL: Documents, bn_internal(3)</title>
<style type="text/css"><!--
BODY { position: absolute; left: 0px; top: 0px; background: #666699; }
A { text-decoration: none; font-weight: bold; }
A:link { text-decoration: none; font-weight: bold; color: #666699; }
A:visited { text-decoration: none; font-weight: bold; color: #666699; }
A:hover { text-decoration: none; font-weight: bold; color: #666699; text-decoration: underline; }
#red { color: #cc3333; }
#sf { font-family: arial,helvetica; font-variant: normal; font-style: normal; }
#sfl { font-weight: bold; font-family: arial,helvetica; font-size: 16pt; line-height: 16pt; font-variant: normal; font-style: normal; }
H1 { font-weight: bold; font-size: 18pt; line-height: 18pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
H2 { font-weight: bold; font-size: 14pt; line-height: 14pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
H3 { font-weight: bold; font-size: 12pt; line-height: 12pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
--></style>
</head>
<body link="#6666cc" alink="#6666cc" vlink="#6666cc" bgcolor="#666699" text="#000000"
      marginheight="0" leftmargin="0" rightmargin="0" topmargin="0">
<table width="100%" cellspacing="0" cellpadding="0" border="0" summary="">
  <tr><td align="left" width="100" bgcolor="#666699"><img src="../../images/page-head-tl.jpg" alt="OpenSSL" width="100" height="80"></td><td align="left" colspan="2" width="600" bgcolor="#666699"><img src="../../images/page-head-tm.jpg" alt="" width="600" height="80"></td><td align="right" width="20" bgcolor="#666699">&nbsp;&nbsp;&nbsp;</td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td align="left" width="100"><img src="../../images/page-head-bl.jpg" alt="" width="100" height="20"></td><td align="left" width="20"><img src="../../images/page-head-bm.jpg" alt="" width="20" height="20"></td><td align="left" width="100%" bgcolor="#ffffff">
<table cellspacing="0" cellpadding="0" border="0" summary="">
        <tr>
<td><font face="Arial,Helvetica">&nbsp;<a href="../index.html" onmouseover="self.status = '../'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../'; return true" onblur="self.status = ''; return true"><font color="#666666">Documents</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../apps/openssl.html" onmouseover="self.status = '../apps/openssl.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../apps/openssl.html'; return true" onblur="self.status = ''; return true"><font color="#666666">openssl(1)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../ssl/ssl.html" onmouseover="self.status = '../ssl/ssl.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../ssl/ssl.html'; return true" onblur="self.status = ''; return true"><font color="#666666">ssl(3)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="crypto.html" onmouseover="self.status = '../crypto/crypto.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../crypto/crypto.html'; return true" onblur="self.status = ''; return true"><font color="#666666">crypto(3)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../HOWTO/index.html" onmouseover="self.status = '../HOWTO/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../HOWTO/'; return true" onblur="self.status = ''; return true"><font color="#666666">HOWTO</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://wiki.openssl.org/" onmouseover="self.status = 'http://wiki.openssl.org/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = 'http://wiki.openssl.org/'; return true" onblur="self.status = ''; return true"><font color="#666666">Wiki</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../fips/index.html" onmouseover="self.status = '../fips/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../fips/'; return true" onblur="self.status = ''; return true"><font color="#666666">FIPS140</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../misc/index.html" onmouseover="self.status = '../misc/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../misc/'; return true" onblur="self.status = ''; return true"><font color="#666666">misc</font></a></font>&nbsp;</td><td></td>
</tr>
      </table>
</td><td align="right" width="20"><img src="../../images/page-corner-tr.gif" alt="" width="20" height="20"></td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td align="left" valign="top" width="100" bgcolor="#666699"><table cellspacing="0" cellpadding="0" border="0" summary=""><tr><td><img src="../../images/page-navbar-top.jpg" alt="" width="100" height="11"></td></tr>
<script type="text/javascript" language="JavaScript">
<!-- Hiding the code
function nb_imgNormal(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_n.src');
        self.status = '';
    }
}
function nb_imgSelect(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_s.src');
        self.status = '';
    }
}
function nb_imgOver(imgName, nohints, descript) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_o.src');
        if (! nohints) self.status = descript;
    }
}
// done hiding -->
</script>
<script type="text/javascript" language="JavaScript">
<!-- Hiding the code
if (document.images) {
    nb_img1_title_n = new Image();
    nb_img1_title_n.src = '../../images/page-navbar-ti-n.jpg';
    nb_img1_title_o = new Image();
    nb_img1_title_o.src = '../../images/page-navbar-ti-s.jpg';
    nb_img1_FAQ_n = new Image();
    nb_img1_FAQ_n.src = '../../images/page-navbar-fq-n.jpg';
    nb_img1_FAQ_o = new Image();
    nb_img1_FAQ_o.src = '../../images/page-navbar-fq-s.jpg';
    nb_img1_about_n = new Image();
    nb_img1_about_n.src = '../../images/page-navbar-ab-n.jpg';
    nb_img1_about_o = new Image();
    nb_img1_about_o.src = '../../images/page-navbar-ab-s.jpg';
    nb_img1_news_n = new Image();
    nb_img1_news_n.src = '../../images/page-navbar-ne-n.jpg';
    nb_img1_news_o = new Image();
    nb_img1_news_o.src = '../../images/page-navbar-ne-s.jpg';
    nb_img1_docs_s = new Image();
    nb_img1_docs_s.src = '../../images/page-navbar-do-s.jpg';
    nb_img1_docs_o = new Image();
    nb_img1_docs_o.src = '../../images/page-navbar-do-s.jpg';
    nb_img1_source_n = new Image();
    nb_img1_source_n.src = '../../images/page-navbar-so-n.jpg';
    nb_img1_source_o = new Image();
    nb_img1_source_o.src = '../../images/page-navbar-so-s.jpg';
    nb_img1_contrib_n = new Image();
    nb_img1_contrib_n.src = '../../images/page-navbar-co-n.jpg';
    nb_img1_contrib_o = new Image();
    nb_img1_contrib_o.src = '../../images/page-navbar-co-s.jpg';
    nb_img1_support_n = new Image();
    nb_img1_support_n.src = '../../images/page-navbar-su-n.jpg';
    nb_img1_support_o = new Image();
    nb_img1_support_o.src = '../../images/page-navbar-su-s.jpg';
    nb_img1_related_n = new Image();
    nb_img1_related_n.src = '../../images/page-navbar-re-n.jpg';
    nb_img1_related_o = new Image();
    nb_img1_related_o.src = '../../images/page-navbar-re-s.jpg';
}
// done hiding -->
</script>
<tr><td><a href="../../index.html" onmouseover="nb_imgOver('nb_img1_title', 0, 'Title'); return true" onmouseout="nb_imgNormal('nb_img1_title'); return true" onfocus="nb_imgOver('nb_img1_title', 0, 'Title'); return true" onblur="nb_imgNormal('nb_img1_title'); return true"><img name="nb_img1_title" src="../../images/page-navbar-ti-n.jpg" alt="Title" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../support/faq.html" onmouseover="nb_imgOver('nb_img1_FAQ', 0, 'FAQ'); return true" onmouseout="nb_imgNormal('nb_img1_FAQ'); return true" onfocus="nb_imgOver('nb_img1_FAQ', 0, 'FAQ'); return true" onblur="nb_imgNormal('nb_img1_FAQ'); return true"><img name="nb_img1_FAQ" src="../../images/page-navbar-fq-n.jpg" alt="FAQ" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../about/index.html" onmouseover="nb_imgOver('nb_img1_about', 0, 'About'); return true" onmouseout="nb_imgNormal('nb_img1_about'); return true" onfocus="nb_imgOver('nb_img1_about', 0, 'About'); return true" onblur="nb_imgNormal('nb_img1_about'); return true"><img name="nb_img1_about" src="../../images/page-navbar-ab-n.jpg" alt="About" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../news/index.html" onmouseover="nb_imgOver('nb_img1_news', 0, 'News'); return true" onmouseout="nb_imgNormal('nb_img1_news'); return true" onfocus="nb_imgOver('nb_img1_news', 0, 'News'); return true" onblur="nb_imgNormal('nb_img1_news'); return true"><img name="nb_img1_news" src="../../images/page-navbar-ne-n.jpg" alt="News" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../index.html" onmouseover="nb_imgOver('nb_img1_docs', 0, 'Documents'); return true" onmouseout="nb_imgSelect('nb_img1_docs'); return true" onfocus="nb_imgOver('nb_img1_docs', 0, 'Documents'); return true" onblur="nb_imgSelect('nb_img1_docs'); return true"><img name="nb_img1_docs" src="../../images/page-navbar-do-s.jpg" alt="Documents" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../source/index.html" onmouseover="nb_imgOver('nb_img1_source', 0, 'Source'); return true" onmouseout="nb_imgNormal('nb_img1_source'); return true" onfocus="nb_imgOver('nb_img1_source', 0, 'Source'); return true" onblur="nb_imgNormal('nb_img1_source'); return true"><img name="nb_img1_source" src="../../images/page-navbar-so-n.jpg" alt="Source" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../contrib/index.html" onmouseover="nb_imgOver('nb_img1_contrib', 0, 'Contribution'); return true" onmouseout="nb_imgNormal('nb_img1_contrib'); return true" onfocus="nb_imgOver('nb_img1_contrib', 0, 'Contribution'); return true" onblur="nb_imgNormal('nb_img1_contrib'); return true"><img name="nb_img1_contrib" src="../../images/page-navbar-co-n.jpg" alt="Contribution" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../support/index.html" onmouseover="nb_imgOver('nb_img1_support', 0, 'Support'); return true" onmouseout="nb_imgNormal('nb_img1_support'); return true" onfocus="nb_imgOver('nb_img1_support', 0, 'Support'); return true" onblur="nb_imgNormal('nb_img1_support'); return true"><img name="nb_img1_support" src="../../images/page-navbar-su-n.jpg" alt="Support" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../related/index.html" onmouseover="nb_imgOver('nb_img1_related', 0, 'Related'); return true" onmouseout="nb_imgNormal('nb_img1_related'); return true" onfocus="nb_imgOver('nb_img1_related', 0, 'Related'); return true" onblur="nb_imgNormal('nb_img1_related'); return true"><img name="nb_img1_related" src="../../images/page-navbar-re-n.jpg" alt="Related" border="0" width="100" height="27"></a></td></tr>
    <tr><td><img src="../../images/page-navbar-bot.jpg" alt="" width="100" height="150"><br><p></td></tr>
  </table>
</td><td align="left" valign="top" width="20" bgcolor="#ffffff">&nbsp;</td><td align="left" valign="top" bgcolor="#ffffff"><br>
        
<h1>bn_internal(3)</h1>
<!-- INDEX BEGIN -->
<UL>
	<LI><A HREF="bn_internal.html#NAME">NAME</A>
	<LI><A HREF="bn_internal.html#SYNOPSIS">SYNOPSIS</A>
	<LI><A HREF="bn_internal.html#DESCRIPTION">DESCRIPTION</A>
	<UL>
		<LI><A HREF="bn_internal.html#The_BIGNUM_structure">The BIGNUM structure</A>
		<LI><A HREF="bn_internal.html#Low_level_arithmetic_operations">Low-level arithmetic operations</A>
		<LI><A HREF="bn_internal.html#Size_changes">Size changes</A>
		<LI><A HREF="bn_internal.html#Debugging">Debugging</A>
	</UL>
	<LI><A HREF="bn_internal.html#SEE_ALSO">SEE ALSO</A>
</UL>
<!-- INDEX END -->
<HR>
<P>
<HR>
<H1><A NAME="NAME">NAME</A></H1>
<P>
bn_mul_words, bn_mul_add_words, bn_sqr_words, bn_div_words, bn_add_words,
bn_sub_words, bn_mul_comba4, bn_mul_comba8, bn_sqr_comba4, bn_sqr_comba8,
bn_cmp_words, bn_mul_normal, bn_mul_low_normal, bn_mul_recursive,
bn_mul_part_recursive, bn_mul_low_recursive, bn_mul_high, bn_sqr_normal,
bn_sqr_recursive, bn_expand, bn_wexpand, bn_expand2, bn_fix_top,
bn_check_top, bn_print, bn_dump, bn_set_max, bn_set_high, bn_set_low -
BIGNUM library internal functions
</P>
<P>
<HR>
<H1><A NAME="SYNOPSIS">SYNOPSIS</A></H1>
<PRE> #include &lt;openssl/bn.h&gt;
</PRE>
<PRE> BN_ULONG bn_mul_words(BN_ULONG *rp, BN_ULONG *ap, int num, BN_ULONG w);
 BN_ULONG bn_mul_add_words(BN_ULONG *rp, BN_ULONG *ap, int num,
   BN_ULONG w);
 void     bn_sqr_words(BN_ULONG *rp, BN_ULONG *ap, int num);
 BN_ULONG bn_div_words(BN_ULONG h, BN_ULONG l, BN_ULONG d);
 BN_ULONG bn_add_words(BN_ULONG *rp, BN_ULONG *ap, BN_ULONG *bp,
   int num);
 BN_ULONG bn_sub_words(BN_ULONG *rp, BN_ULONG *ap, BN_ULONG *bp,
   int num);
</PRE>
<PRE> void bn_mul_comba4(BN_ULONG *r, BN_ULONG *a, BN_ULONG *b);
 void bn_mul_comba8(BN_ULONG *r, BN_ULONG *a, BN_ULONG *b);
 void bn_sqr_comba4(BN_ULONG *r, BN_ULONG *a);
 void bn_sqr_comba8(BN_ULONG *r, BN_ULONG *a);
</PRE>
<PRE> int bn_cmp_words(BN_ULONG *a, BN_ULONG *b, int n);
</PRE>
<PRE> void bn_mul_normal(BN_ULONG *r, BN_ULONG *a, int na, BN_ULONG *b,
   int nb);
 void bn_mul_low_normal(BN_ULONG *r, BN_ULONG *a, BN_ULONG *b, int n);
 void bn_mul_recursive(BN_ULONG *r, BN_ULONG *a, BN_ULONG *b, int n2,
   int dna,int dnb,BN_ULONG *tmp);
 void bn_mul_part_recursive(BN_ULONG *r, BN_ULONG *a, BN_ULONG *b,
   int n, int tna,int tnb, BN_ULONG *tmp);
 void bn_mul_low_recursive(BN_ULONG *r, BN_ULONG *a, BN_ULONG *b,
   int n2, BN_ULONG *tmp);
 void bn_mul_high(BN_ULONG *r, BN_ULONG *a, BN_ULONG *b, BN_ULONG *l,
   int n2, BN_ULONG *tmp);
</PRE>
<PRE> void bn_sqr_normal(BN_ULONG *r, BN_ULONG *a, int n, BN_ULONG *tmp);
 void bn_sqr_recursive(BN_ULONG *r, BN_ULONG *a, int n2, BN_ULONG *tmp);
</PRE>
<PRE> void mul(BN_ULONG r, BN_ULONG a, BN_ULONG w, BN_ULONG c);
 void mul_add(BN_ULONG r, BN_ULONG a, BN_ULONG w, BN_ULONG c);
 void sqr(BN_ULONG r0, BN_ULONG r1, BN_ULONG a);
</PRE>
<PRE> BIGNUM *bn_expand(BIGNUM *a, int bits);
 BIGNUM *bn_wexpand(BIGNUM *a, int n);
 BIGNUM *bn_expand2(BIGNUM *a, int n);
 void bn_fix_top(BIGNUM *a);
</PRE>
<PRE> void bn_check_top(BIGNUM *a);
 void bn_print(BIGNUM *a);
 void bn_dump(BN_ULONG *d, int n);
 void bn_set_max(BIGNUM *a);
 void bn_set_high(BIGNUM *r, BIGNUM *a, int n);
 void bn_set_low(BIGNUM *r, BIGNUM *a, int n);
</PRE>
<P>
<HR>
<H1><A NAME="DESCRIPTION">DESCRIPTION</A></H1>
<P>
This page documents the internal functions used by the OpenSSL
<STRONG>BIGNUM</STRONG> implementation. They are described here to facilitate debugging and
extending the library. They are <EM>not</EM> to be used by applications.
</P>
<P>
<HR>
<H2><A NAME="The_BIGNUM_structure">The BIGNUM structure</A></H2>
<PRE> typedef struct bignum_st BIGNUM;
</PRE>
<PRE> struct bignum_st
        {
        BN_ULONG *d;    /* Pointer to an array of 'BN_BITS2' bit chunks. */
        int top;        /* Index of last used d +1. */
        /* The next are internal book keeping for bn_expand. */
        int dmax;       /* Size of the d array. */
        int neg;        /* one if the number is negative */
        int flags;
        };
</PRE>
<P>
The integer value is stored in <STRONG>d</STRONG>, a <CODE>malloc()ed</CODE> array of words (<STRONG>BN_ULONG</STRONG>), least significant word first. A <STRONG>BN_ULONG</STRONG> can be either 16, 32 or 64 bits in size, depending on the 'number of bits'
(<STRONG>BITS2</STRONG>) specified in
<CODE>openssl/bn.h</CODE>.
</P>
<P>
<STRONG>dmax</STRONG> is the size of the <STRONG>d</STRONG> array that has been allocated. <STRONG>top</STRONG>
is the number of words being used, so for a value of 4, bn.d&#91;0&#93;=4 and
bn.top=1. <STRONG>neg</STRONG> is 1 if the number is negative. When a <STRONG>BIGNUM</STRONG> is
<STRONG>0</STRONG>, the <STRONG>d</STRONG> field can be <STRONG>NULL</STRONG> and <STRONG>top</STRONG> == <STRONG>0</STRONG>.
</P>
<P>
<STRONG>flags</STRONG> is a bit field of flags which are defined in <CODE>openssl/bn.h</CODE>. The flags begin with <STRONG>BN_FLG_</STRONG>. The macros <CODE>BN_set_flags(b,n)</CODE> and
<CODE>BN_get_flags(b,n)</CODE> exist to enable or fetch
<CODE>flag(s)</CODE> <STRONG>n</STRONG> from <STRONG>BIGNUM</STRONG>
structure <STRONG>b</STRONG>.
</P>
<P>
Various routines in this library require the use of temporary
<STRONG>BIGNUM</STRONG> variables during their execution. Since dynamic memory allocation to create <STRONG>BIGNUM</STRONG>s is rather expensive when used in conjunction with repeated subroutine
calls, the <STRONG>BN_CTX</STRONG> structure is used. This structure contains <STRONG>BN_CTX_NUM</STRONG>  <STRONG>BIGNUM</STRONG>s, see
<A HREF="BN_CTX_start.html#">BN_CTX_start(3)</A>.
</P>
<P>
<HR>
<H2><A NAME="Low_level_arithmetic_operations">Low-level arithmetic operations</A></H2>
<P>
These functions are implemented in C and for several platforms in assembly
language:
</P>
<P>
<CODE>bn_mul_words(</CODE><STRONG>rp</STRONG>, <STRONG>ap</STRONG>, <STRONG>num</STRONG>, <STRONG>w</STRONG>) operates on the <STRONG>num</STRONG> word arrays <STRONG>rp</STRONG> and <STRONG>ap</STRONG>. It computes <STRONG>ap</STRONG> * <STRONG>w</STRONG>, places the result in <STRONG>rp</STRONG>, and returns the high word (carry).
</P>
<P>
<CODE>bn_mul_add_words(</CODE><STRONG>rp</STRONG>, <STRONG>ap</STRONG>, <STRONG>num</STRONG>, <STRONG>w</STRONG>) operates on the <STRONG>num</STRONG>
word arrays <STRONG>rp</STRONG> and <STRONG>ap</STRONG>. It computes <STRONG>ap</STRONG> * <STRONG>w</STRONG> + <STRONG>rp</STRONG>, places the result in <STRONG>rp</STRONG>, and returns the high word (carry).
</P>
<P>
<CODE>bn_sqr_words(</CODE><STRONG>rp</STRONG>, <STRONG>ap</STRONG>, <STRONG>n</STRONG>) operates on the <STRONG>num</STRONG> word array
<STRONG>ap</STRONG> and the 2*<STRONG>num</STRONG> word array <STRONG>ap</STRONG>. It computes <STRONG>ap</STRONG> * <STRONG>ap</STRONG>
word-wise, and places the low and high bytes of the result in <STRONG>rp</STRONG>.
</P>
<P>
<CODE>bn_div_words(</CODE><STRONG>h</STRONG>, <STRONG>l</STRONG>, <STRONG>d</STRONG>) divides the two word number (<STRONG>h</STRONG>,<STRONG>l</STRONG>) by <STRONG>d</STRONG> and returns the result.
</P>
<P>
<CODE>bn_add_words(</CODE><STRONG>rp</STRONG>, <STRONG>ap</STRONG>, <STRONG>bp</STRONG>, <STRONG>num</STRONG>) operates on the <STRONG>num</STRONG> word arrays <STRONG>ap</STRONG>, <STRONG>bp</STRONG> and <STRONG>rp</STRONG>. It computes <STRONG>ap</STRONG> + <STRONG>bp</STRONG>, places the result in <STRONG>rp</STRONG>, and returns the high word (carry).
</P>
<P>
<CODE>bn_sub_words(</CODE><STRONG>rp</STRONG>, <STRONG>ap</STRONG>, <STRONG>bp</STRONG>, <STRONG>num</STRONG>) operates on the <STRONG>num</STRONG> word arrays <STRONG>ap</STRONG>, <STRONG>bp</STRONG> and <STRONG>rp</STRONG>. It computes <STRONG>ap</STRONG> - <STRONG>bp</STRONG>, places the result in <STRONG>rp</STRONG>, and returns the carry (1 if <STRONG>bp</STRONG>  &gt; <STRONG>ap</STRONG>, 0 otherwise).
</P>
<P>
<CODE>bn_mul_comba4(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>) operates on the 4 word arrays <STRONG>a</STRONG> and
<STRONG>b</STRONG> and the 8 word array <STRONG>r</STRONG>. It computes <STRONG>a</STRONG>*<STRONG>b</STRONG> and places the result in <STRONG>r</STRONG>.
</P>
<P>
<CODE>bn_mul_comba8(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>) operates on the 8 word arrays <STRONG>a</STRONG> and
<STRONG>b</STRONG> and the 16 word array <STRONG>r</STRONG>. It computes <STRONG>a</STRONG>*<STRONG>b</STRONG> and places the result in <STRONG>r</STRONG>.
</P>
<P>
<CODE>bn_sqr_comba4(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>) operates on the 4 word arrays <STRONG>a</STRONG> and
<STRONG>b</STRONG> and the 8 word array <STRONG>r</STRONG>.
</P>
<P>
<CODE>bn_sqr_comba8(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>) operates on the 8 word arrays <STRONG>a</STRONG> and
<STRONG>b</STRONG> and the 16 word array <STRONG>r</STRONG>.
</P>
<P>
The following functions are implemented in C:
</P>
<P>
<CODE>bn_cmp_words(</CODE><STRONG>a</STRONG>, <STRONG>b</STRONG>, <STRONG>n</STRONG>) operates on the <STRONG>n</STRONG> word arrays <STRONG>a</STRONG>
and <STRONG>b</STRONG>. It returns 1, 0 and -1 if <STRONG>a</STRONG> is greater than, equal and less than <STRONG>b</STRONG>.
</P>
<P>
<CODE>bn_mul_normal(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>na</STRONG>, <STRONG>b</STRONG>, <STRONG>nb</STRONG>) operates on the <STRONG>na</STRONG>
word array <STRONG>a</STRONG>, the <STRONG>nb</STRONG> word array <STRONG>b</STRONG> and the <STRONG>na</STRONG>+<STRONG>nb</STRONG> word array <STRONG>r</STRONG>. It computes <STRONG>a</STRONG>*<STRONG>b</STRONG> and places the result in <STRONG>r</STRONG>.
</P>
<P>
<CODE>bn_mul_low_normal(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>, <STRONG>n</STRONG>) operates on the <STRONG>n</STRONG> word arrays <STRONG>r</STRONG>, <STRONG>a</STRONG> and <STRONG>b</STRONG>. It computes the <STRONG>n</STRONG> low words of
<STRONG>a</STRONG>*<STRONG>b</STRONG> and places the result in <STRONG>r</STRONG>.
</P>
<P>
<CODE>bn_mul_recursive(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>, <STRONG>n2</STRONG>, <STRONG>dna</STRONG>, <STRONG>dnb</STRONG>, <STRONG>t</STRONG>) operates on the word arrays <STRONG>a</STRONG> and <STRONG>b</STRONG> of length <STRONG>n2</STRONG>+<STRONG>dna</STRONG> and <STRONG>n2</STRONG>+<STRONG>dnb</STRONG>
(<STRONG>dna</STRONG> and <STRONG>dnb</STRONG> are currently allowed to be 0 or negative) and the 2*<STRONG>n2</STRONG>
word arrays <STRONG>r</STRONG> and <STRONG>t</STRONG>. <STRONG>n2</STRONG> must be a power of 2. It computes
<STRONG>a</STRONG>*<STRONG>b</STRONG> and places the result in <STRONG>r</STRONG>.
</P>
<P>
<CODE>bn_mul_part_recursive(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>, <STRONG>n</STRONG>, <STRONG>tna</STRONG>, <STRONG>tnb</STRONG>, <STRONG>tmp</STRONG>) operates on the word arrays <STRONG>a</STRONG> and <STRONG>b</STRONG> of length <STRONG>n</STRONG>+<STRONG>tna</STRONG> and
<STRONG>n</STRONG>+<STRONG>tnb</STRONG> and the 4*<STRONG>n</STRONG> word arrays <STRONG>r</STRONG> and <STRONG>tmp</STRONG>.
</P>
<P>
<CODE>bn_mul_low_recursive(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>, <STRONG>n2</STRONG>, <STRONG>tmp</STRONG>) operates on the
<STRONG>n2</STRONG> word arrays <STRONG>r</STRONG> and <STRONG>tmp</STRONG> and the <STRONG>n2</STRONG>/2 word arrays <STRONG>a</STRONG>
and <STRONG>b</STRONG>.
</P>
<P>
<CODE>bn_mul_high(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG>, <STRONG>l</STRONG>, <STRONG>n2</STRONG>, <STRONG>tmp</STRONG>) operates on the
<STRONG>n2</STRONG> word arrays <STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>b</STRONG> and <STRONG>l</STRONG> (?) and the 3*<STRONG>n2</STRONG> word array <STRONG>tmp</STRONG>.
</P>
<P>
<CODE>BN_mul()</CODE> calls <CODE>bn_mul_normal(),</CODE> or an optimized
implementation if the factors have the same size:
<CODE>bn_mul_comba8()</CODE> is used if they are 8 words long,
<CODE>bn_mul_recursive()</CODE> if they are larger than
<STRONG>BN_MULL_SIZE_NORMAL</STRONG> and the size is an exact multiple of the word size, and
<CODE>bn_mul_part_recursive()</CODE> for others that are larger than
<STRONG>BN_MULL_SIZE_NORMAL</STRONG>.
</P>
<P>
<CODE>bn_sqr_normal(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>n</STRONG>, <STRONG>tmp</STRONG>) operates on the <STRONG>n</STRONG> word array
<STRONG>a</STRONG> and the 2*<STRONG>n</STRONG> word arrays <STRONG>tmp</STRONG> and <STRONG>r</STRONG>.
</P>
<P>
The implementations use the following macros which, depending on the
architecture, may use ``long long'' C operations or inline assembler. They
are defined in <CODE>bn_lcl.h</CODE>.
</P>
<P>
<CODE>mul(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>w</STRONG>, <STRONG>c</STRONG>) computes <STRONG>w</STRONG>*<STRONG>a</STRONG>+<STRONG>c</STRONG> and places the low word of the result in <STRONG>r</STRONG> and the high word in <STRONG>c</STRONG>.
</P>
<P>
<CODE>mul_add(</CODE><STRONG>r</STRONG>, <STRONG>a</STRONG>, <STRONG>w</STRONG>, <STRONG>c</STRONG>) computes <STRONG>w</STRONG>*<STRONG>a</STRONG>+<STRONG>r</STRONG>+<STRONG>c</STRONG> and places the low word of the result in <STRONG>r</STRONG> and the high word in <STRONG>c</STRONG>.
</P>
<P>
<CODE>sqr(</CODE><STRONG>r0</STRONG>, <STRONG>r1</STRONG>, <STRONG>a</STRONG>) computes <STRONG>a</STRONG>*<STRONG>a</STRONG> and places the low word of the result in <STRONG>r0</STRONG> and the high word in <STRONG>r1</STRONG>.
</P>
<P>
<HR>
<H2><A NAME="Size_changes">Size changes</A></H2>
<P>
<CODE>bn_expand()</CODE> ensures that <STRONG>b</STRONG> has enough space for a <STRONG>bits</STRONG> bit number. <CODE>bn_wexpand()</CODE> ensures that <STRONG>b</STRONG> has enough space for an
<STRONG>n</STRONG> word number. If the number has to be expanded, both macros call
<CODE>bn_expand2(),</CODE> which allocates a new <STRONG>d</STRONG> array and copies the data. They return <STRONG>NULL</STRONG> on error, <STRONG>b</STRONG> otherwise.
</P>
<P>
The <CODE>bn_fix_top()</CODE> macro reduces <STRONG>a-&gt;top</STRONG> to point to the most significant non-zero word plus one when <STRONG>a</STRONG> has shrunk.
</P>
<P>
<HR>
<H2><A NAME="Debugging">Debugging</A></H2>
<P>
<CODE>bn_check_top()</CODE> verifies that <CODE>((a)-&amp;gt;top &amp;gt;= 0 &amp;&amp; (a)-&amp;gt;top
&amp;lt;= (a)-&amp;gt;dmax)</CODE>. A violation will cause the program to abort.
</P>
<P>
<CODE>bn_print()</CODE> prints <STRONG>a</STRONG> to stderr. <CODE>bn_dump()</CODE> prints <STRONG>n</STRONG> words at <STRONG>d</STRONG>
(in reverse order, i.e. most significant word first) to stderr.
</P>
<P>
<CODE>bn_set_max()</CODE> makes <STRONG>a</STRONG> a static number with a <STRONG>dmax</STRONG> of its current size. This is used by <CODE>bn_set_low()</CODE> and
<CODE>bn_set_high()</CODE> to make <STRONG>r</STRONG> a read-only
<STRONG>BIGNUM</STRONG> that contains the <STRONG>n</STRONG> low or high words of <STRONG>a</STRONG>.
</P>
<P>
If <STRONG>BN_DEBUG</STRONG> is not defined, <CODE>bn_check_top(),</CODE> <CODE>bn_print(),</CODE>
<CODE>bn_dump()</CODE> and <CODE>bn_set_max()</CODE> are defined as empty
macros.
</P>
<P>
<HR>
<H1><A NAME="SEE_ALSO">SEE ALSO</A></H1>
<P>
<A HREF="bn.html#">bn(3)</A>
</P>
        </td><td align="right" width="20" bgcolor="#ffffff">&nbsp;&nbsp;&nbsp;</td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td align="left" valign="top" width="100" bgcolor="#666699">&nbsp;</td><td align="left" width="20"><img src="../../images/page-corner-bl.gif" alt="" width="20" height="20"></td><td align="left" valign="top" bgcolor="#ffffff">&nbsp;</td><td align="right" width="20"><img src="../../images/page-corner-br.gif" alt="" width="20" height="20"></td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td colspan="5" bgcolor="#666699">&nbsp;</td></tr>
</table>
</body>
</html>

