<html>
<head>
<!--
     Copyright (c) 1998-2014 The OpenSSL Project, http://www.openssl.org/
     Author:   OpenSSL (openssl@openssl.org)
     Modified: 2014-08-26 20:00:29.
     Generated from ``SSL_CTX_set_options.wml'' via WML 2.0.11 (19-Aug-2006).
               by OpenSSL (openssl@openssl.org)
               on 2014-08-26 20:00:55.

     DO NOT EDIT THIS FILE DIRECTLY! INSTEAD EDIT ``SSL_CTX_set_options.wml''.
-->
<meta name="Copyright" content="1998-2014 The OpenSSL Project, http://www.openssl.org/">
<meta name="Author"    content="OpenSSL, openssl@openssl.org">
<meta name="Generator" content="WML 2.0.11 (19-Aug-2006)">
<meta name="Modified"  content="2014-08-26 20:00:29">
<title>OpenSSL: Documents, SSL_CTX_set_options(3)</title>
<style type="text/css"><!--
BODY { position: absolute; left: 0px; top: 0px; background: #666699; }
A { text-decoration: none; font-weight: bold; }
A:link { text-decoration: none; font-weight: bold; color: #666699; }
A:visited { text-decoration: none; font-weight: bold; color: #666699; }
A:hover { text-decoration: none; font-weight: bold; color: #666699; text-decoration: underline; }
#red { color: #cc3333; }
#sf { font-family: arial,helvetica; font-variant: normal; font-style: normal; }
#sfl { font-weight: bold; font-family: arial,helvetica; font-size: 16pt; line-height: 16pt; font-variant: normal; font-style: normal; }
H1 { font-weight: bold; font-size: 18pt; line-height: 18pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
H2 { font-weight: bold; font-size: 14pt; line-height: 14pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
H3 { font-weight: bold; font-size: 12pt; line-height: 12pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
--></style>
</head>
<body link="#6666cc" alink="#6666cc" vlink="#6666cc" bgcolor="#666699" text="#000000"
      marginheight="0" leftmargin="0" rightmargin="0" topmargin="0">
<table width="100%" cellspacing="0" cellpadding="0" border="0" summary="">
  <tr><td align="left" width="100" bgcolor="#666699"><img src="../../images/page-head-tl.jpg" alt="OpenSSL" width="100" height="80"></td><td align="left" colspan="2" width="600" bgcolor="#666699"><img src="../../images/page-head-tm.jpg" alt="" width="600" height="80"></td><td align="right" width="20" bgcolor="#666699">&nbsp;&nbsp;&nbsp;</td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td align="left" width="100"><img src="../../images/page-head-bl.jpg" alt="" width="100" height="20"></td><td align="left" width="20"><img src="../../images/page-head-bm.jpg" alt="" width="20" height="20"></td><td align="left" width="100%" bgcolor="#ffffff">
<table cellspacing="0" cellpadding="0" border="0" summary="">
        <tr>
<td><font face="Arial,Helvetica">&nbsp;<a href="../index.html" onmouseover="self.status = '../'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../'; return true" onblur="self.status = ''; return true"><font color="#666666">Documents</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../apps/openssl.html" onmouseover="self.status = '../apps/openssl.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../apps/openssl.html'; return true" onblur="self.status = ''; return true"><font color="#666666">openssl(1)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="ssl.html" onmouseover="self.status = '../ssl/ssl.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../ssl/ssl.html'; return true" onblur="self.status = ''; return true"><font color="#666666">ssl(3)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../crypto/crypto.html" onmouseover="self.status = '../crypto/crypto.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../crypto/crypto.html'; return true" onblur="self.status = ''; return true"><font color="#666666">crypto(3)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../HOWTO/index.html" onmouseover="self.status = '../HOWTO/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../HOWTO/'; return true" onblur="self.status = ''; return true"><font color="#666666">HOWTO</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://wiki.openssl.org/" onmouseover="self.status = 'http://wiki.openssl.org/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = 'http://wiki.openssl.org/'; return true" onblur="self.status = ''; return true"><font color="#666666">Wiki</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../fips/index.html" onmouseover="self.status = '../fips/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../fips/'; return true" onblur="self.status = ''; return true"><font color="#666666">FIPS140</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="../misc/index.html" onmouseover="self.status = '../misc/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../misc/'; return true" onblur="self.status = ''; return true"><font color="#666666">misc</font></a></font>&nbsp;</td><td></td>
</tr>
      </table>
</td><td align="right" width="20"><img src="../../images/page-corner-tr.gif" alt="" width="20" height="20"></td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td align="left" valign="top" width="100" bgcolor="#666699"><table cellspacing="0" cellpadding="0" border="0" summary=""><tr><td><img src="../../images/page-navbar-top.jpg" alt="" width="100" height="11"></td></tr>
<script type="text/javascript" language="JavaScript">
<!-- Hiding the code
function nb_imgNormal(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_n.src');
        self.status = '';
    }
}
function nb_imgSelect(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_s.src');
        self.status = '';
    }
}
function nb_imgOver(imgName, nohints, descript) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_o.src');
        if (! nohints) self.status = descript;
    }
}
// done hiding -->
</script>
<script type="text/javascript" language="JavaScript">
<!-- Hiding the code
if (document.images) {
    nb_img1_title_n = new Image();
    nb_img1_title_n.src = '../../images/page-navbar-ti-n.jpg';
    nb_img1_title_o = new Image();
    nb_img1_title_o.src = '../../images/page-navbar-ti-s.jpg';
    nb_img1_FAQ_n = new Image();
    nb_img1_FAQ_n.src = '../../images/page-navbar-fq-n.jpg';
    nb_img1_FAQ_o = new Image();
    nb_img1_FAQ_o.src = '../../images/page-navbar-fq-s.jpg';
    nb_img1_about_n = new Image();
    nb_img1_about_n.src = '../../images/page-navbar-ab-n.jpg';
    nb_img1_about_o = new Image();
    nb_img1_about_o.src = '../../images/page-navbar-ab-s.jpg';
    nb_img1_news_n = new Image();
    nb_img1_news_n.src = '../../images/page-navbar-ne-n.jpg';
    nb_img1_news_o = new Image();
    nb_img1_news_o.src = '../../images/page-navbar-ne-s.jpg';
    nb_img1_docs_s = new Image();
    nb_img1_docs_s.src = '../../images/page-navbar-do-s.jpg';
    nb_img1_docs_o = new Image();
    nb_img1_docs_o.src = '../../images/page-navbar-do-s.jpg';
    nb_img1_source_n = new Image();
    nb_img1_source_n.src = '../../images/page-navbar-so-n.jpg';
    nb_img1_source_o = new Image();
    nb_img1_source_o.src = '../../images/page-navbar-so-s.jpg';
    nb_img1_contrib_n = new Image();
    nb_img1_contrib_n.src = '../../images/page-navbar-co-n.jpg';
    nb_img1_contrib_o = new Image();
    nb_img1_contrib_o.src = '../../images/page-navbar-co-s.jpg';
    nb_img1_support_n = new Image();
    nb_img1_support_n.src = '../../images/page-navbar-su-n.jpg';
    nb_img1_support_o = new Image();
    nb_img1_support_o.src = '../../images/page-navbar-su-s.jpg';
    nb_img1_related_n = new Image();
    nb_img1_related_n.src = '../../images/page-navbar-re-n.jpg';
    nb_img1_related_o = new Image();
    nb_img1_related_o.src = '../../images/page-navbar-re-s.jpg';
}
// done hiding -->
</script>
<tr><td><a href="../../index.html" onmouseover="nb_imgOver('nb_img1_title', 0, 'Title'); return true" onmouseout="nb_imgNormal('nb_img1_title'); return true" onfocus="nb_imgOver('nb_img1_title', 0, 'Title'); return true" onblur="nb_imgNormal('nb_img1_title'); return true"><img name="nb_img1_title" src="../../images/page-navbar-ti-n.jpg" alt="Title" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../support/faq.html" onmouseover="nb_imgOver('nb_img1_FAQ', 0, 'FAQ'); return true" onmouseout="nb_imgNormal('nb_img1_FAQ'); return true" onfocus="nb_imgOver('nb_img1_FAQ', 0, 'FAQ'); return true" onblur="nb_imgNormal('nb_img1_FAQ'); return true"><img name="nb_img1_FAQ" src="../../images/page-navbar-fq-n.jpg" alt="FAQ" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../about/index.html" onmouseover="nb_imgOver('nb_img1_about', 0, 'About'); return true" onmouseout="nb_imgNormal('nb_img1_about'); return true" onfocus="nb_imgOver('nb_img1_about', 0, 'About'); return true" onblur="nb_imgNormal('nb_img1_about'); return true"><img name="nb_img1_about" src="../../images/page-navbar-ab-n.jpg" alt="About" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../news/index.html" onmouseover="nb_imgOver('nb_img1_news', 0, 'News'); return true" onmouseout="nb_imgNormal('nb_img1_news'); return true" onfocus="nb_imgOver('nb_img1_news', 0, 'News'); return true" onblur="nb_imgNormal('nb_img1_news'); return true"><img name="nb_img1_news" src="../../images/page-navbar-ne-n.jpg" alt="News" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../index.html" onmouseover="nb_imgOver('nb_img1_docs', 0, 'Documents'); return true" onmouseout="nb_imgSelect('nb_img1_docs'); return true" onfocus="nb_imgOver('nb_img1_docs', 0, 'Documents'); return true" onblur="nb_imgSelect('nb_img1_docs'); return true"><img name="nb_img1_docs" src="../../images/page-navbar-do-s.jpg" alt="Documents" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../source/index.html" onmouseover="nb_imgOver('nb_img1_source', 0, 'Source'); return true" onmouseout="nb_imgNormal('nb_img1_source'); return true" onfocus="nb_imgOver('nb_img1_source', 0, 'Source'); return true" onblur="nb_imgNormal('nb_img1_source'); return true"><img name="nb_img1_source" src="../../images/page-navbar-so-n.jpg" alt="Source" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../contrib/index.html" onmouseover="nb_imgOver('nb_img1_contrib', 0, 'Contribution'); return true" onmouseout="nb_imgNormal('nb_img1_contrib'); return true" onfocus="nb_imgOver('nb_img1_contrib', 0, 'Contribution'); return true" onblur="nb_imgNormal('nb_img1_contrib'); return true"><img name="nb_img1_contrib" src="../../images/page-navbar-co-n.jpg" alt="Contribution" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../support/index.html" onmouseover="nb_imgOver('nb_img1_support', 0, 'Support'); return true" onmouseout="nb_imgNormal('nb_img1_support'); return true" onfocus="nb_imgOver('nb_img1_support', 0, 'Support'); return true" onblur="nb_imgNormal('nb_img1_support'); return true"><img name="nb_img1_support" src="../../images/page-navbar-su-n.jpg" alt="Support" border="0" width="100" height="27"></a></td></tr>
<tr><td><a href="../../related/index.html" onmouseover="nb_imgOver('nb_img1_related', 0, 'Related'); return true" onmouseout="nb_imgNormal('nb_img1_related'); return true" onfocus="nb_imgOver('nb_img1_related', 0, 'Related'); return true" onblur="nb_imgNormal('nb_img1_related'); return true"><img name="nb_img1_related" src="../../images/page-navbar-re-n.jpg" alt="Related" border="0" width="100" height="27"></a></td></tr>
    <tr><td><img src="../../images/page-navbar-bot.jpg" alt="" width="100" height="150"><br><p></td></tr>
  </table>
</td><td align="left" valign="top" width="20" bgcolor="#ffffff">&nbsp;</td><td align="left" valign="top" bgcolor="#ffffff"><br>
        
<h1>SSL_CTX_set_options(3)</h1>
<!-- INDEX BEGIN -->
<UL>
	<LI><A HREF="SSL_CTX_set_options.html#NAME">NAME</A>
	<LI><A HREF="SSL_CTX_set_options.html#SYNOPSIS">SYNOPSIS</A>
	<LI><A HREF="SSL_CTX_set_options.html#DESCRIPTION">DESCRIPTION</A>
	<LI><A HREF="SSL_CTX_set_options.html#NOTES">NOTES</A>
	<LI><A HREF="SSL_CTX_set_options.html#SECURE_RENEGOTIATION">SECURE RENEGOTIATION</A>
	<UL>
		<LI><A HREF="SSL_CTX_set_options.html#Patched_client_and_server">Patched client and server</A>
		<LI><A HREF="SSL_CTX_set_options.html#Unpatched_client_and_patched_Ope">Unpatched client and patched OpenSSL server</A>
		<LI><A HREF="SSL_CTX_set_options.html#Patched_OpenSSL_client_and_unpat">Patched OpenSSL client and unpatched server.</A>
	</UL>
	<LI><A HREF="SSL_CTX_set_options.html#RETURN_VALUES">RETURN VALUES</A>
	<LI><A HREF="SSL_CTX_set_options.html#SEE_ALSO">SEE ALSO</A>
	<LI><A HREF="SSL_CTX_set_options.html#HISTORY">HISTORY</A>
</UL>
<!-- INDEX END -->
<HR>
<P>
<HR>
<H1><A NAME="NAME">NAME</A></H1>
<P>
SSL_CTX_set_options, SSL_set_options, SSL_CTX_clear_options,
SSL_clear_options, SSL_CTX_get_options, SSL_get_options,
SSL_get_secure_renegotiation_support - manipulate SSL options
</P>
<P>
<HR>
<H1><A NAME="SYNOPSIS">SYNOPSIS</A></H1>
<PRE> #include &lt;openssl/ssl.h&gt;
</PRE>
<PRE> long SSL_CTX_set_options(SSL_CTX *ctx, long options);
 long SSL_set_options(SSL *ssl, long options);
</PRE>
<PRE> long SSL_CTX_clear_options(SSL_CTX *ctx, long options);
 long SSL_clear_options(SSL *ssl, long options);
</PRE>
<PRE> long SSL_CTX_get_options(SSL_CTX *ctx);
 long SSL_get_options(SSL *ssl);
</PRE>
<PRE> long SSL_get_secure_renegotiation_support(SSL *ssl);
</PRE>
<P>
<HR>
<H1><A NAME="DESCRIPTION">DESCRIPTION</A></H1>
<P>
Note: all these functions are implemented using macros.
</P>
<P>
<CODE>SSL_CTX_set_options()</CODE> adds the options set via bitmask in <STRONG>options</STRONG> to <STRONG>ctx</STRONG>. Options already set before are not cleared!
</P>
<P>
<CODE>SSL_set_options()</CODE> adds the options set via bitmask in <STRONG>options</STRONG> to <STRONG>ssl</STRONG>. Options already set before are not cleared!
</P>
<P>
<CODE>SSL_CTX_clear_options()</CODE> clears the options set via bitmask in <STRONG>options</STRONG>
to <STRONG>ctx</STRONG>.
</P>
<P>
<CODE>SSL_clear_options()</CODE> clears the options set via bitmask in <STRONG>options</STRONG> to <STRONG>ssl</STRONG>.
</P>
<P>
<CODE>SSL_CTX_get_options()</CODE> returns the options set for <STRONG>ctx</STRONG>.
</P>
<P>
<CODE>SSL_get_options()</CODE> returns the options set for <STRONG>ssl</STRONG>.
</P>
<P>
<CODE>SSL_get_secure_renegotiation_support()</CODE> indicates whether the
peer supports secure renegotiation.
</P>
<P>
<HR>
<H1><A NAME="NOTES">NOTES</A></H1>
<P>
The behaviour of the SSL library can be changed by setting several options.
The options are coded as bitmasks and can be combined by a bitwise <STRONG>or</STRONG>
operation (|).
</P>
<P>
<CODE>SSL_CTX_set_options()</CODE> and <CODE>SSL_set_options()</CODE>
affect the (external) protocol behaviour of the SSL library. The (internal)
behaviour of the API can be changed by using the similar
<A HREF="SSL_CTX_set_mode.html#">SSL_CTX_set_mode(3)</A> and <CODE>SSL_set_mode()</CODE> functions.
</P>
<P>
During a handshake, the option settings of the SSL object are used. When a
new SSL object is created from a context using <CODE>SSL_new(),</CODE> the
current option setting is copied. Changes to <STRONG>ctx</STRONG> do not affect already created SSL objects. <CODE>SSL_clear()</CODE> does
not affect the settings.
</P>
<P>
The following <STRONG>bug workaround</STRONG> options are available:
</P>
<DL>
<DT><STRONG><A NAME="item_SSL_OP_MICROSOFT_SESS_ID_BUG">SSL_OP_MICROSOFT_SESS_ID_BUG</A></STRONG><DD>
<P>
www.microsoft.com - when talking SSLv2, if session-id reuse is performed,
the session-id passed back in the server-finished message is different from
the one decided upon.
</P>
<DT><STRONG><A NAME="item_SSL_OP_NETSCAPE_CHALLENGE_BUG">SSL_OP_NETSCAPE_CHALLENGE_BUG</A></STRONG><DD>
<P>
Netscape-Commerce/1.12, when talking SSLv2, accepts a 32 byte challenge but
then appears to only use 16 bytes when generating the encryption keys.
Using 16 bytes is ok but it should be ok to use 32. According to the SSLv3
spec, one should use 32 bytes for the challenge when operating in SSLv2/v3
compatibility mode, but as mentioned above, this breaks this server so 16
bytes is the way to go.
</P>
<DT><STRONG><A NAME="item_SSL_OP_NETSCAPE_REUSE_CIPHER_CHA">SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG</A></STRONG><DD>
<P>
As of OpenSSL 0.9.8q and 1.0.0c, this option has no effect.
</P>
<DT><STRONG><A NAME="item_SSL_OP_SSLREF2_REUSE_CERT_TYPE_B">SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_MICROSOFT_BIG_SSLV3_BUFFE">SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_SAFARI_ECDHE_ECDSA_BUG">SSL_OP_SAFARI_ECDHE_ECDSA_BUG</A></STRONG><DD>
<P>
Don't prefer ECDHE-ECDSA ciphers when the client appears to be Safari on OS
X. OS X 10.8..10.8.3 has broken support for ECDHE-ECDSA ciphers.
</P>
<DT><STRONG><A NAME="item_SSL_OP_SSLEAY_080_CLIENT_DH_BUG">SSL_OP_SSLEAY_080_CLIENT_DH_BUG</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_TLS_D5_BUG">SSL_OP_TLS_D5_BUG</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_TLS_BLOCK_PADDING_BUG">SSL_OP_TLS_BLOCK_PADDING_BUG</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_DONT_INSERT_EMPTY_FRAGMEN">SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</A></STRONG><DD>
<P>
Disables a countermeasure against a SSL 3.0/TLS 1.0 protocol vulnerability
affecting CBC ciphers, which cannot be handled by some broken SSL
implementations. This option has no effect for connections using other
ciphers.
</P>
<DT><STRONG><A NAME="item_SSL_OP_TLSEXT_PADDING">SSL_OP_TLSEXT_PADDING</A></STRONG><DD>
<P>
Adds a padding extension to ensure the ClientHello size is never between
256 and 511 bytes in length. This is needed as a workaround for some
implementations.
</P>
<DT><STRONG><A NAME="item_SSL_OP_ALL">SSL_OP_ALL</A></STRONG><DD>
<P>
All of the above bug workarounds.
</P>
</DL>
<P>
It is usually safe to use <STRONG>SSL_OP_ALL</STRONG> to enable the bug workaround options if compatibility with somewhat broken
implementations is desired.
</P>
<P>
The following <STRONG>modifying</STRONG> options are available:
</P>
<DL>
<DT><STRONG><A NAME="item_SSL_OP_TLS_ROLLBACK_BUG">SSL_OP_TLS_ROLLBACK_BUG</A></STRONG><DD>
<P>
Disable version rollback attack detection.
</P>
<P>
During the client key exchange, the client must send the same information
about acceptable SSL/TLS protocol levels as during the first hello. Some
clients violate this rule by adapting to the server's answer. (Example: the
client sends a SSLv2 hello and accepts up to SSLv3.1=TLSv1, the server only
understands up to SSLv3. In this case the client must still use the same
SSLv3.1=TLSv1 announcement. Some clients step down to SSLv3 with respect to
the server's answer and violate the version rollback protection.)
</P>
<DT><STRONG><A NAME="item_SSL_OP_SINGLE_DH_USE">SSL_OP_SINGLE_DH_USE</A></STRONG><DD>
<P>
Always create a new key when using temporary/ephemeral DH parameters (see <A HREF="SSL_CTX_set_tmp_dh_callback.html#">SSL_CTX_set_tmp_dh_callback(3)</A>). This option must be used to prevent small subgroup attacks, when the DH
parameters were not generated using ``strong'' primes (e.g. when using
DSA-parameters, see <A HREF="../apps/dhparam.html#">dhparam(1)</A>). If ``strong'' primes were used, it is not strictly necessary to generate
a new DH key during each handshake but it is also recommended.
<STRONG>SSL_OP_SINGLE_DH_USE</STRONG> should therefore be enabled whenever temporary/ephemeral DH parameters are
used.
</P>
<DT><STRONG><A NAME="item_SSL_OP_EPHEMERAL_RSA">SSL_OP_EPHEMERAL_RSA</A></STRONG><DD>
<P>
Always use ephemeral (temporary) RSA key when doing RSA operations (see <A HREF="SSL_CTX_set_tmp_rsa_callback.html#">SSL_CTX_set_tmp_rsa_callback(3)</A>). According to the specifications this is only done, when a RSA key can
only be used for signature operations (namely under export ciphers with
restricted RSA keylength). By setting this option, ephemeral RSA keys are
always used. This option breaks compatibility with the SSL/TLS
specifications and may lead to interoperability problems with clients and
should therefore never be used. Ciphers with DHE (ephemeral Diffie-Hellman)
key exchange should be used instead.
</P>
<DT><STRONG><A NAME="item_SSL_OP_CIPHER_SERVER_PREFERENCE">SSL_OP_CIPHER_SERVER_PREFERENCE</A></STRONG><DD>
<P>
When choosing a cipher, use the server's preferences instead of the client
preferences. When not set, the SSL server will always follow the clients
preferences. When set, the SSLv3/TLSv1 server will choose following its own
preferences. Because of the different protocol, for SSLv2 the server will
send its list of preferences to the client and the client chooses.
</P>
<DT><STRONG><A NAME="item_SSL_OP_PKCS1_CHECK_1">SSL_OP_PKCS1_CHECK_1</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_PKCS1_CHECK_2">SSL_OP_PKCS1_CHECK_2</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_NETSCAPE_CA_DN_BUG">SSL_OP_NETSCAPE_CA_DN_BUG</A></STRONG><DD>
<P>
If we accept a netscape connection, demand a client cert, have a
non-self-signed CA which does not have its CA in netscape, and the browser
has a cert, it will crash/hang. Works for 3.x and 4.xbeta
</P>
<DT><STRONG><A NAME="item_SSL_OP_NETSCAPE_DEMO_CIPHER_CHAN">SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG</A></STRONG><DD>
<P>
...
</P>
<DT><STRONG><A NAME="item_SSL_OP_NO_SSLv2">SSL_OP_NO_SSLv2</A></STRONG><DD>
<P>
Do not use the SSLv2 protocol.
</P>
<DT><STRONG><A NAME="item_SSL_OP_NO_SSLv3">SSL_OP_NO_SSLv3</A></STRONG><DD>
<P>
Do not use the SSLv3 protocol.
</P>
<DT><STRONG><A NAME="item_SSL_OP_NO_TLSv1">SSL_OP_NO_TLSv1</A></STRONG><DD>
<P>
Do not use the TLSv1 protocol.
</P>
<DT><STRONG><A NAME="item_SSL_OP_NO_SESSION_RESUMPTION_ON_">SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION</A></STRONG><DD>
<P>
When performing renegotiation as a server, always start a new session
(i.e., session resumption requests are only accepted in the initial
handshake). This option is not needed for clients.
</P>
<DT><STRONG><A NAME="item_SSL_OP_NO_TICKET">SSL_OP_NO_TICKET</A></STRONG><DD>
<P>
Normally clients and servers will, where possible, transparently make use
of RFC4507bis tickets for stateless session resumption.
</P>
<P>
If this option is set this functionality is disabled and tickets will not
be used by clients or servers.
</P>
<DT><STRONG><A NAME="item_SSL_OP_ALLOW_UNSAFE_LEGACY_RENEG">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</A></STRONG><DD>
<P>
Allow legacy insecure renegotiation between OpenSSL and unpatched clients
or servers. See the <STRONG>SECURE RENEGOTIATION</STRONG> section for more details.
</P>
<DT><STRONG><A NAME="item_SSL_OP_LEGACY_SERVER_CONNECT">SSL_OP_LEGACY_SERVER_CONNECT</A></STRONG><DD>
<P>
Allow legacy insecure renegotiation between OpenSSL and unpatched servers
<STRONG>only</STRONG>: this option is currently set by default. See the
<STRONG>SECURE RENEGOTIATION</STRONG> section for more details.
</P>
</DL>
<P>
<HR>
<H1><A NAME="SECURE_RENEGOTIATION">SECURE RENEGOTIATION</A></H1>
<P>
OpenSSL 0.9.8m and later always attempts to use secure renegotiation as
described in RFC5746. This counters the prefix attack described in
CVE-2009-3555 and elsewhere.
</P>
<P>
The deprecated and highly broken SSLv2 protocol does not support
renegotiation at all: its use is <STRONG>strongly</STRONG> discouraged.
</P>
<P>
This attack has far reaching consequences which application writers should
be aware of. In the description below an implementation supporting secure
renegotiation is referred to as <EM>patched</EM>. A server not supporting secure renegotiation is referred to as <EM>unpatched</EM>.
</P>
<P>
The following sections describe the operations permitted by OpenSSL's
secure renegotiation implementation.
</P>
<P>
<HR>
<H2><A NAME="Patched_client_and_server">Patched client and server</A></H2>
<P>
Connections and renegotiation are always permitted by OpenSSL
implementations.
</P>
<P>
<HR>
<H2><A NAME="Unpatched_client_and_patched_Ope">Unpatched client and patched OpenSSL server</A></H2>
<P>
The initial connection succeeds but client renegotiation is denied by the
server with a <STRONG>no_renegotiation</STRONG> warning alert if TLS v1.0 is used or a fatal
<STRONG>handshake_failure</STRONG> alert in SSL v3.0.
</P>
<P>
If the patched OpenSSL server attempts to renegotiate a fatal
<STRONG>handshake_failure</STRONG> alert is sent. This is because the server code may be unaware of the
unpatched nature of the client.
</P>
<P>
If the option <STRONG>SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</STRONG> is set then renegotiation <STRONG>always</STRONG> succeeds.
</P>
<P>
<STRONG>NB:</STRONG> a bug in OpenSSL clients earlier than 0.9.8m (all of which are unpatched)
will result in the connection hanging if it receives a
<STRONG>no_renegotiation</STRONG> alert. OpenSSL versions 0.9.8m and later will regard a <STRONG>no_renegotiation</STRONG> alert as fatal and respond with a fatal
<STRONG>handshake_failure</STRONG> alert. This is because the OpenSSL API currently has no provision to
indicate to an application that a renegotiation attempt was refused.
</P>
<P>
<HR>
<H2><A NAME="Patched_OpenSSL_client_and_unpat">Patched OpenSSL client and unpatched server.</A></H2>
<P>
If the option <STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG> or
<STRONG>SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</STRONG> is set then initial connections and renegotiation between patched OpenSSL
clients and unpatched servers succeeds. If neither option is set then
initial connections to unpatched servers will fail.
</P>
<P>
The option <STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG> is currently set by default even though it has security implications:
otherwise it would be impossible to connect to unpatched servers (i.e. all
of them initially) and this is clearly not acceptable. Renegotiation is
permitted because this does not add any additional security issues: during
an attack clients do not see any renegotiations anyway.
</P>
<P>
As more servers become patched the option <STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG> will
<STRONG>not</STRONG> be set by default in a future version of OpenSSL.
</P>
<P>
OpenSSL client applications wishing to ensure they can connect to unpatched
servers should always <STRONG>set</STRONG>  <STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG>
</P>
<P>
OpenSSL client applications that want to ensure they can <STRONG>not</STRONG> connect to unpatched servers (and thus avoid any security issues) should
always <STRONG>clear</STRONG>
<STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG> using <CODE>SSL_CTX_clear_options()</CODE> or
<CODE>SSL_clear_options().</CODE>
</P>
<P>
The difference between the <STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG> and
<STRONG>SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</STRONG> options is that
<STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG> enables initial connections and secure renegotiation between OpenSSL
clients and unpatched servers <STRONG>only</STRONG>, while
<STRONG>SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</STRONG> allows initial connections and renegotiation between OpenSSL and unpatched
clients or servers.
</P>
<P>
<HR>
<H1><A NAME="RETURN_VALUES">RETURN VALUES</A></H1>
<P>
<CODE>SSL_CTX_set_options()</CODE> and <CODE>SSL_set_options()</CODE>
return the new options bitmask after adding <STRONG>options</STRONG>.
</P>
<P>
<CODE>SSL_CTX_clear_options()</CODE> and <CODE>SSL_clear_options()</CODE>
return the new options bitmask after clearing <STRONG>options</STRONG>.
</P>
<P>
<CODE>SSL_CTX_get_options()</CODE> and <CODE>SSL_get_options()</CODE>
return the current bitmask.
</P>
<P>
<CODE>SSL_get_secure_renegotiation_support()</CODE> returns 1 is the peer
supports secure renegotiation and 0 if it does not.
</P>
<P>
<HR>
<H1><A NAME="SEE_ALSO">SEE ALSO</A></H1>
<P>
<A HREF="ssl.html#">ssl(3)</A>, <A HREF="SSL_new.html#">SSL_new(3)</A>, <A HREF="SSL_clear.html#">SSL_clear(3)</A>,
<A HREF="SSL_CTX_set_tmp_dh_callback.html#">SSL_CTX_set_tmp_dh_callback(3)</A>,
<A HREF="SSL_CTX_set_tmp_rsa_callback.html#">SSL_CTX_set_tmp_rsa_callback(3)</A>,
<A HREF="../apps/dhparam.html#">dhparam(1)</A>
</P>
<P>
<HR>
<H1><A NAME="HISTORY">HISTORY</A></H1>
<P>
<STRONG>SSL_OP_CIPHER_SERVER_PREFERENCE</STRONG> and
<STRONG>SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION</STRONG> have been added in OpenSSL 0.9.7.
</P>
<P>
<STRONG>SSL_OP_TLS_ROLLBACK_BUG</STRONG> has been added in OpenSSL 0.9.6 and was automatically enabled with <STRONG>SSL_OP_ALL</STRONG>. As of 0.9.7, it is no longer included in <STRONG>SSL_OP_ALL</STRONG>
and must be explicitly set.
</P>
<P>
<STRONG>SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</STRONG> has been added in OpenSSL 0.9.6e. Versions up to OpenSSL 0.9.6c do not
include the countermeasure that can be disabled with this option (in
OpenSSL 0.9.6d, it was always enabled).
</P>
<P>
<CODE>SSL_CTX_clear_options()</CODE> and <CODE>SSL_clear_options()</CODE>
were first added in OpenSSL 0.9.8m.
</P>
<P>
<STRONG>SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</STRONG>, <STRONG>SSL_OP_LEGACY_SERVER_CONNECT</STRONG>
and the function <CODE>SSL_get_secure_renegotiation_support()</CODE> were
first added in OpenSSL 0.9.8m.
</P>
        </td><td align="right" width="20" bgcolor="#ffffff">&nbsp;&nbsp;&nbsp;</td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td align="left" valign="top" width="100" bgcolor="#666699">&nbsp;</td><td align="left" width="20"><img src="../../images/page-corner-bl.gif" alt="" width="20" height="20"></td><td align="left" valign="top" bgcolor="#ffffff">&nbsp;</td><td align="right" width="20"><img src="../../images/page-corner-br.gif" alt="" width="20" height="20"></td><td align="right" width="50" bgcolor="#666699">&nbsp;</td></tr>
  <tr><td colspan="5" bgcolor="#666699">&nbsp;</td></tr>
</table>
</body>
</html>

